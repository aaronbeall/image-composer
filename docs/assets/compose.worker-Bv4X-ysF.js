(function(){"use strict";function Q(e){let t=0;for(let n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t>>>0}function K(e){let t=e|0;return()=>{t|=0,t=t+1831565813|0;let n=Math.imul(t^t>>>15,1|t);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}function z(e,t,n,h,{fit:m,backgroundColor:d,cornerRadius:r,borderEnabled:x,borderWidth:y,borderColor:W,shadowEnabled:f,shadowAngle:X,shadowDistance:H,shadowBlur:p,shadowColor:M,effects:g,jitterPosition:k,jitterSize:u,jitterRotation:o,shape:v}){if(e.canvas.width=t.canvasWidth,e.canvas.height=t.canvasHeight,e.clearRect(0,0,e.canvas.width,e.canvas.height),d&&d!=="transparent"){if(e.save(),e.globalAlpha=1,e.fillStyle=d,v==="circle"){const S=t.canvasWidth/2,l=t.canvasHeight/2,c=Math.min(t.canvasWidth,t.canvasHeight)/2;e.beginPath(),e.arc(S,l,c,0,Math.PI*2),e.fill()}else e.fillRect(0,0,e.canvas.width,e.canvas.height);e.restore()}const w=t.items.length?Math.max(...t.items.map(S=>Math.min(S.w,S.h))):0,Y=r>0&&w>0?r/100*(w/2):0,s=t.items.length?t.items.reduce((S,l)=>S+Math.min(l.w,l.h),0)/t.items.length:0,b=x&&y>0&&s>0?{color:W,width:y/100*(s*.1)}:void 0,A=f&&(H>0||p>0)&&s>0?(()=>{const S=H/100*(s*.2),l=p/100*(s*.2),c=X*Math.PI/180;return{color:M,offsetX:S*Math.cos(c),offsetY:S*Math.sin(c),blur:l}})():void 0;for(const S of t.items){const l=n[S.imageIndex],c=l.id||l.src||`img-${S.imageIndex}`,a=K(Q(String(c))^S.imageIndex),I=Math.min(S.w,S.h)*.25*(Math.max(0,k)/100),i=.3*(Math.max(0,u)/100),C=Math.max(0,o),P=V=>(a()-.5)*2*V,E=1+P(i),R=P(I),F=P(I),O=P(C)*(Math.PI/180),$=S.x+S.w/2,_=S.y+S.h/2,D=S.w*E,L=S.h*E,G=$+R-D/2,J=_+F-L/2;nt(e,{...S,x:G,y:J,w:D,h:L},n[S.imageIndex],h[S.imageIndex],{fit:t.fit??m,cornerRadiusTargetPx:Y,border:b,dropShadow:A,effects:g,rotationRad:O,shape:v})}}function N(e,t,n,h,m,d,r="rect"){if(r==="circle"){const x=Math.min(h,m)/2;e.arc(t+h/2,n+m/2,x,0,Math.PI*2),e.closePath();return}if(d>0){const x=Math.min(h,m)/2,y=Math.min(d,x);e.moveTo(t+y,n),e.lineTo(t+h-y,n),e.arcTo(t+h,n,t+h,n+y,y),e.lineTo(t+h,n+m-y),e.arcTo(t+h,n+m,t+h-y,n+m,y),e.lineTo(t+y,n+m),e.arcTo(t,n+m,t,n+m-y,y),e.lineTo(t,n+y),e.arcTo(t,n,t+y,n,y),e.closePath()}else e.rect(t,n,h,m)}function tt(e,t,n,h,m,d,r="overlay"){const x=document.createElement("canvas");x.width=Math.max(1,Math.floor(h)),x.height=Math.max(1,Math.floor(m));const y=x.getContext("2d");if(!y)return;const W=y.createImageData(x.width,x.height),f=W.data,X=Math.max(0,Math.min(100,d))/100*64;for(let H=0;H<f.length;H+=4){const p=Math.random()<.5?0:255;f[H]=p,f[H+1]=p,f[H+2]=p,f[H+3]=X}y.putImageData(W,0,0),e.save(),e.globalCompositeOperation=r,e.drawImage(x,t,n,h,m),e.restore()}function et(e,t,n,h,m,d,r="overlay"){e.save();const x=t+h/2,y=n+m/2,W=Math.sqrt(h*h+m*m)/2,f=e.createRadialGradient(x,y,0,x,y,W);f.addColorStop(0,"rgba(0, 0, 0, 0)"),f.addColorStop(1,`rgba(0, 0, 0, ${d/100})`),e.globalCompositeOperation=r,e.fillStyle=f,e.beginPath(),e.rect(t,n,h,m),e.fill(),e.restore()}function at(e,t,n,h,m,d){const r=d/100,y=e.getImageData(t,n,h,m).data,W=h,f=m,X=[0,-r,0,-r,1+4*r,-r,0,-r,0],H=new Uint8ClampedArray(y);for(let p=1;p<f-1;p++)for(let M=1;M<W-1;M++){let g=0,k=0,u=0;for(let v=-1;v<=1;v++)for(let w=-1;w<=1;w++){const Y=((p+v)*W+(M+w))*4,s=X[(v+1)*3+(w+1)];g+=y[Y]*s,k+=y[Y+1]*s,u+=y[Y+2]*s}const o=(p*W+M)*4;H[o]=Math.max(0,Math.min(255,g)),H[o+1]=Math.max(0,Math.min(255,k)),H[o+2]=Math.max(0,Math.min(255,u))}e.putImageData(new ImageData(H,W,f),t,n)}function nt(e,t,n,h,{fit:m,cornerRadiusTargetPx:d=0,border:r,dropShadow:x,effects:y=[],rotationRad:W=0,shape:f="rect"}){const{x:X,y:H,w:p,h:M}=t,g=h.width/h.height,k=p/M;let u=p,o=M,v=0,w=0,Y=h.width,s=h.height;m?k>g?(Y=h.width,s=Y/k,w=(h.height-s)/2):(s=h.height,Y=s*k,v=(h.width-Y)/2):k>g?(u=M*g,o=M):(u=p,o=p/g);const b=X+(p-u)/2,A=H+(M-o)/2,S=b+u/2,l=A+o/2;e.save(),e.translate(S,l),W&&e.rotate(W),e.translate(-S,-l);const c=d>0?Math.min(d,Math.min(u,o)/2):0;x&&(e.save(),e.shadowColor=x.color,e.shadowBlur=x.blur,e.shadowOffsetX=x.offsetX,e.shadowOffsetY=x.offsetY,e.beginPath(),N(e,b,A,u,o,c,f),e.fillStyle="black",e.fill(),e.restore()),e.save();const a=[],I=[];if(y.length>0){for(const i of y)switch(i.type){case"blur":a.push(`blur(${i.value}px)`);break;case"brightness":a.push(`brightness(${i.value}%)`);break;case"contrast":a.push(`contrast(${i.value}%)`);break;case"grayscale":a.push(`grayscale(${i.value}%)`);break;case"hue-rotate":a.push(`hue-rotate(${i.value}deg)`);break;case"invert":a.push(`invert(${i.value}%)`);break;case"saturate":a.push(`saturate(${i.value}%)`);break;case"sepia":a.push(`sepia(${i.value}%)`);break;case"grain":case"vignette":case"sharpen":case"bloom":I.push(i);break}a.length>0&&(e.filter=a.join(" "))}e.beginPath(),N(e,b,A,u,o,c,f),e.clip(),e.drawImage(h,v,w,Y,s,b,A,u,o);for(const i of I)switch(i.type){case"grain":tt(e,b,A,u,o,i.value,i.blendMode??"overlay");break;case"vignette":et(e,b,A,u,o,i.value,i.blendMode??"overlay");break;case"sharpen":at(e,b,A,u,o,i.value);break;case"bloom":{const C=Math.max(0,Math.min(100,i.value))/100,P=Math.max(0,i.blur??10),E=i.blendMode??"overlay";e.save(),e.globalCompositeOperation=E,e.globalAlpha=C,e.filter=`blur(${P}px)`,e.drawImage(h,v,w,Y,s,b,A,u,o),e.restore();break}}e.restore(),r&&r.width>0&&(e.save(),e.strokeStyle=r.color,e.lineWidth=r.width,e.beginPath(),N(e,b,A,u,o,c,f),e.stroke(),e.restore()),n.label&&(e.font="bold 14px sans-serif",e.fillStyle="#fff",e.fillText(n.label,b+4,A+16)),n.description&&(e.font="12px sans-serif",e.fillStyle="#fff",e.fillText(n.description,b+4,A+o-6)),e.restore()}function ot(e,t,n,h){const d=1+n/100;if(h==="random"){const x=e*12345+67890,y=K(x)(),W=Math.min(1,d),f=Math.max(1,d);return W+y*(f-W)}const r=t>1?e/(t-1):0;if(h==="linear")return 1+r*(d-1);if(h==="exponential")return 1+r*r*(d-1);if(h==="bulge")return 1+(1-Math.pow(r-.5,2)*4)*(d-1);if(h==="peak"){const x=Math.abs(r-.5)*2;return 1+Math.pow(1-x,3)*(d-1)}return 1}function st(e,t="both"){const n=e.map(d=>d.width),h=e.map(d=>d.height);n.sort((d,r)=>d-r),h.sort((d,r)=>d-r);const m=Math.floor(e.length/2);return{width:t==="height"?0:n[m],height:t==="width"?0:h[m]}}const U=3200;function rt({loadedImages:e,images:t,normalizeSize:n,layout:h,spacing:m,fit:d,scale:r,justify:x,resizeEnabled:y,resizeAmount:W,resizeSequence:f}){if(!e||!e.length||e.length!==t.length)return{canvasWidth:1,canvasHeight:1,items:[]};let X={width:0,height:0};if(n){let w="both";h==="single-row"?w="height":(h==="single-column"||h==="masonry")&&(w="width"),X=st(e,w)}const H=e.map((w,Y)=>{let s=w.width,b=w.height;if(n){if(h==="single-row"&&X.height)s=Math.round(X.height*(s/b)),b=X.height;else if((h==="single-column"||h==="masonry")&&X.width)b=Math.round(X.width*(b/s)),s=X.width;else if(X.width&&X.height){const A=s/b;A>X.width/X.height?(s=X.width,b=Math.round(X.width/A)):(b=X.height,s=Math.round(X.height*A))}}if(y){const A=ot(Y,e.length,W,f);s=Math.round(s*A),b=Math.round(b*A)}return s=Math.max(1,s),b=Math.max(1,b),{w:s,h:b}}),p=H.reduce((w,Y)=>w+Y.w,0)/H.length,M=H.reduce((w,Y)=>w+Y.h,0)/H.length,g=m/100*.5,k=Math.round(g*((p+M)/2)),u=(()=>{switch(h){case"single-row":return ht(e,H,k,d);case"single-column":return lt(e,H,k,d);case"grid":return it(e,H,k,d,x);case"masonry":return ct(e,H,k,d,x);case"packed":return ut(H,k,x);case"cluster":return dt(H,k);case"squarified":return wt(H,k);case"lanes":return mt(e,H,k,d,x);case"bubble":return ft(e,H,k);default:return{canvasWidth:800,canvasHeight:600,items:[]}}})(),o=Math.min(U/u.canvasWidth,U/u.canvasHeight),v={canvasWidth:u.canvasWidth*o,canvasHeight:u.canvasHeight*o,items:u.items.map(w=>({...w,x:w.x*o,y:w.y*o,w:w.w*o,h:w.h*o}))};return{...u,canvasWidth:v.canvasWidth*r,canvasHeight:v.canvasHeight*r,items:v.items.map(w=>({...w,x:w.x*r,y:w.y*r,w:w.w*r,h:w.h*r}))}}function ht(e,t,n=0,h=!1){const m=Math.max(...t.map(W=>W.h))+2*n;let d,r=[];if(h){const W=m-2*n;r=e.map(f=>Math.round(W*(f.width/f.height))),d=r.reduce((f,X,H)=>f+X+(H>0?n:0),0)+2*n}else d=t.reduce((W,f,X)=>W+f.w+(X>0?n:0),0)+2*n;const x=[];let y=n;return e.forEach((W,f)=>{const X=h?r[f]:t[f].w,H=h?m-2*n:t[f].h,p=h?n:n+(m-2*n-H)/2;x.push({x:y,y:p,w:X,h:H,imageIndex:f}),y+=X+n}),{canvasWidth:d,canvasHeight:m,items:x}}function lt(e,t,n=0,h=!1){const m=Math.max(...t.map(W=>W.w))+2*n;let d,r=[];if(h){const W=m-2*n;r=e.map(f=>Math.round(W*(f.height/f.width))),d=r.reduce((f,X,H)=>f+X+(H>0?n:0),0)+2*n}else d=t.reduce((W,f,X)=>W+f.h+(X>0?n:0),0)+2*n;const x=[];let y=n;return e.forEach((W,f)=>{if(h){const X=m-2*n,H=r[f];x.push({x:(m-X)/2,y,w:X,h:H,imageIndex:f}),y+=H+n}else{const X=(m-2*n-t[f].w)/2+n;x.push({x:X,y,w:t[f].w,h:t[f].h,imageIndex:f}),y+=t[f].h+n}}),{canvasWidth:m,canvasHeight:d,items:x}}function it(e,t,n=0,h=!1,m=!1){const d=e.length,r=Math.ceil(Math.sqrt(d)),x=Math.ceil(d/r),y=Math.max(...t.map(g=>g.w)),W=Math.max(...t.map(g=>g.h)),f=r*y+(r-1)*n+2*n,X=x*W+(x-1)*n+2*n,H=[],p=d%r,M=p>0&&p<r;for(let g=0;g<d;++g){const k=g%r,u=Math.floor(g/r),o=u===x-1;if(m&&M&&o){const v=p,w=f-2*n,Y=(v-1)*n,s=(w-Y)/v,b=k*(s+n)+n,A=u*(W+n)+n;if(h)H.push({x:b,y:A,w:s,h:W,imageIndex:g});else{const S=t[g].w,l=t[g].h,c=b+(s-S)/2,a=A+(W-l)/2;H.push({x:c,y:a,w:S,h:l,imageIndex:g})}}else{const v=k*(y+n)+n,w=u*(W+n)+n;if(h)H.push({x:v,y:w,w:y,h:W,imageIndex:g});else{const Y=t[g].w,s=t[g].h,b=v+(y-Y)/2,A=w+(W-s)/2;H.push({x:b,y:A,w:Y,h:s,imageIndex:g})}}}return{canvasWidth:f,canvasHeight:X,items:H}}function ct(e,t,n=0,h=!1,m=!1){const d=e.length,r=Math.ceil(Math.sqrt(d)),x=Array(r).fill(0).map((s,b)=>Math.max(...t.filter((A,S)=>S%r===b).map(A=>A.w),0));for(let s=0;s<r-1;++s)x[s]+=n;const y=Array(r).fill(0),W=[],f=[];for(let s=0;s<d;++s){let b=0;for(let I=1;I<r;++I)y[I]<y[b]&&(b=I);const A=x.slice(0,b).reduce((I,i)=>I+i,0),S=x[b]-(b<r-1?n:0),l=y[b]+(y[b]>0?n:0);let c=t[s].w,a=t[s].h;h&&(c=S,a=Math.round(c*(e[s].height/e[s].width))),W.push({x:A+n,y:l+n,w:c,h:a,imageIndex:s}),y[b]+=a+(y[b]>0?n:0),f[s]=b}const X=x.reduce((s,b)=>s+b,0)+2*n,H=Math.max(...y)+2*n;if(!m||d===0)return{canvasWidth:X,canvasHeight:H,items:W};const p=Math.max(...y,0),M=Array.from({length:r},()=>[]);W.forEach((s,b)=>M[f[b]].push(b));const g=Array(r).fill(0),k=Array(d);for(let s=0;s<r;s++){const b=M[s];if(b.length===0)continue;const A=Math.max(0,b.length-1)*n,S=b.reduce((a,I)=>a+W[I].h,0),l=S>0?(p-A)/S:1;let c=n;for(const a of b){const I=W[a],i=I.w*l,C=I.h*l;k[a]={w:i,h:C,y:c},c+=C+n,g[s]=Math.max(g[s],i)}}const u=[];let o=n;for(let s=0;s<r;s++)u[s]=o,o+=(g[s]||0)+n;const v=W.map((s,b)=>{const A=f[b],S=k[b],l=g[A]||s.w;return{x:u[A]+(l-S.w)/2,y:S.y,w:S.w,h:S.h,imageIndex:s.imageIndex}}),w=Math.max(o,X),Y=Math.max(p+n,H);return{canvasWidth:w,canvasHeight:Y,items:v}}function mt(e,t,n=0,h=!1,m=!1){const d=e.length;if(d===0)return{canvasWidth:0,canvasHeight:0,items:[]};const r=Math.max(1,Math.ceil(Math.sqrt(d))),x=[],y=Array(r).fill(0),W=Array(r).fill(0),f=Array(d);for(let l=0;l<d;l++){let c=0;for(let I=1;I<r;I++)W[I]<W[c]&&(c=I);x.push({i:l,row:c}),f[l]=c;const a=t[l].h;y[c]=Math.max(y[c],a),W[c]+=t[l].w+(W[c]>0?n:0)}const X=[];let H=n;for(let l=0;l<r;l++)X[l]=H,H+=y[l]+n;const p=Array(r).fill(0),M=Array(d);for(const{i:l,row:c}of x){const a=e[l].width/e[l].height,I=h?y[c]:t[l].h,i=h?Math.round(I*a):t[l].w,C=n+p[c],P=X[c];M[l]={x:C,y:P,w:i,h:I,imageIndex:l},p[c]+=i+n}const g=Math.max(...p,0)+n,k=H;if(!m)return{canvasWidth:g,canvasHeight:k,items:M};const u=Math.max(...p,0),o=Array.from({length:r},()=>[]);M.forEach((l,c)=>o[f[c]].push(c));const v=Array(r).fill(0),w=Array(d);for(let l=0;l<r;l++){const c=o[l];if(c.length===0)continue;const a=c.length*n,I=c.reduce((P,E)=>P+M[E].w,0),i=I>0?(u-a)/I:1;let C=n;for(const P of c){const E=M[P],R=E.w*i,F=E.h*i;w[P]={w:R,h:F,x:C},C+=R+n,v[l]=Math.max(v[l],F)}}const Y=[];let s=n;for(let l=0;l<r;l++)Y[l]=s,s+=(v[l]||0)+n;const b=M.map((l,c)=>{const a=f[c],I=w[c],i=v[a]||l.h,C=Y[a]+(i-I.h)/2;return{x:I.x,y:C,w:I.w,h:I.h,imageIndex:l.imageIndex}}),A=Math.max(u+n,g),S=Math.max(s,k);return{canvasWidth:A,canvasHeight:S,items:b}}function ft(e,t,n=0){const h=t.length;if(h===0)return{canvasWidth:0,canvasHeight:0,items:[]};const m=t.map((o,v)=>{const w=Math.min(o.w,o.h);return{i:v,side:w,r:w/2,x:0,y:0}}).sort((o,v)=>v.side-o.side),d=Math.PI*2/h,r=m[0].r+n;m.forEach((o,v)=>{const w=v*d,Y=1+v%3*.05,s=r*Y+v*.15*n;o.x=Math.cos(w)*s,o.y=Math.sin(w)*s});const x=220,y=n;for(let o=0;o<x;o++){for(let w=0;w<h;w++)for(let Y=w+1;Y<h;Y++){const s=m[w],b=m[Y];let A=b.x-s.x,S=b.y-s.y,l=Math.hypot(A,S);const c=s.r+b.r+y;if(l===0&&(A=.01,S=0,l=.01),l<c){const I=(c-l)/l*.5,i=A*I,C=S*I;s.x-=i,s.y-=C,b.x+=i,b.y+=C}}const v=.02;for(const w of m)w.x*=1-v,w.y*=1-v}let W=1/0,f=1/0,X=-1/0,H=-1/0;for(const o of m)W=Math.min(W,o.x-o.r),f=Math.min(f,o.y-o.r),X=Math.max(X,o.x+o.r),H=Math.max(H,o.y+o.r);const p=-W+n,M=-f+n,g=X-W+n*2,k=H-f+n*2,u=m.map(o=>({x:o.x-o.r+p,y:o.y-o.r+M,w:o.side,h:o.side,imageIndex:o.i}));return u.sort((o,v)=>o.imageIndex-v.imageIndex),{canvasWidth:g,canvasHeight:k,items:u,fit:!0}}function ut(e,t=0,n=!1){const h=e.reduce((a,I)=>a+I.w*I.h,0),m=Math.max(...e.map(a=>a.w)),d=Math.max(...e.map(a=>a.h));let r=Math.max(Math.ceil(Math.sqrt(h)),m),x=Math.max(Math.ceil(h/r),d);r+=t*2,x+=t*2;function y(a,I,i,C){return{x:a,y:I,w:i,h:C,used:!1,down:null,right:null,imgIdx:null}}function W(a,I,i,C){return a.used?W(a.right,I,i,C)||W(a.down,I,i,C):I<=a.w&&i<=a.h?(a.used=!0,a.imgIdx=C,a.down=y(a.x,a.y+i+t,a.w,a.h-i-t),a.right=y(a.x+I+t,a.y,a.w-I-t,i),{x:a.x,y:a.y}):null}const f=e.map((a,I)=>({i:I,w:a.w,h:a.h,key:Math.max(a.w,a.h),area:a.w*a.h})).sort((a,I)=>I.key-a.key||I.area-a.area),X=Array(e.length);let H=!1,p=0,M=null;for(;!H&&p<10;){M=y(t,t,r-2*t,x-2*t);let a=!1;for(let I=0;I<f.length;++I){const{w:i,h:C,i:P}=f[I],E=W(M,i,C,P);if(!E){a=!0;break}X[P]=E}a?(r<=x?r=Math.round(r*1.2):x=Math.round(x*1.2),p++):H=!0}const g=e.map((a,I)=>({x:X[I].x,y:X[I].y,w:a.w,h:a.h,imageIndex:I}));if(!n||!M)return{canvasWidth:r,canvasHeight:x,items:g};function k(a){const I=[],i=[],C=a.right?k(a.right):null,P=a.down?k(a.down):null;C&&I.push(C),P&&I.push(P),a.right&&a.right.imgIdx!==null&&i.push(a.right.imgIdx),a.down&&a.down.imgIdx!==null&&i.push(a.down.imgIdx),a.imgIdx!==null&&i.push(a.imgIdx);const E=a.imgIdx!==null?(()=>{const T=g[a.imgIdx];return{minX:T.x,maxX:T.x+T.w,minY:T.y,maxY:T.y+T.h}})():null,R=[...I,...E?[E]:[]].reduce((T,B)=>T?{minX:Math.min(T.minX,B.minX),maxX:Math.max(T.maxX,B.maxX),minY:Math.min(T.minY,B.minY),maxY:Math.max(T.maxY,B.maxY)}:{...B},null);if(!R)return null;if(i.length===1&&a.imgIdx!==null){const T=a.imgIdx;return g[T]={...g[T],x:a.x,y:a.y,w:a.w,h:a.h},{minX:a.x,maxX:a.x+a.w,minY:a.y,maxY:a.y+a.h}}const O=R.maxX-R.minX,$=R.maxY-R.minY,_=O>0?a.w/O:1,D=$>0?a.h/$:1;function L(T){if(T.imgIdx!==null){const B=g[T.imgIdx];g[T.imgIdx]={...B,x:a.x+(B.x-R.minX)*_,y:a.y+(B.y-R.minY)*D,w:B.w*_,h:B.h*D}}T.right&&L(T.right),T.down&&L(T.down)}L(a);const G=a.x+(R.minX-R.minX)*_,J=a.x+(R.maxX-R.minX)*_,V=a.y+(R.minY-R.minY)*D,xt=a.y+(R.maxY-R.minY)*D;return{minX:G,maxX:J,minY:V,maxY:xt}}k(M);const u=Math.min(...g.map(a=>a.x),t),o=Math.max(...g.map(a=>a.x+a.w),t),v=Math.min(...g.map(a=>a.y),t),w=Math.max(...g.map(a=>a.y+a.h),t),Y=o-u,s=w-v,b=r-t*2,A=x-t*2,S=Y>0?b/Y:1,l=s>0?A/s:1,c=g.map(a=>({x:t+(a.x-u)*S,y:t+(a.y-v)*l,w:a.w*S,h:a.h*l,imageIndex:a.imageIndex}));return{canvasWidth:r,canvasHeight:x,items:c}}function dt(e,t=0){const n=e.map((u,o)=>({...u,i:o,area:u.w*u.h}));n.sort((u,o)=>o.area-u.area);const h=[];h.push({x:0,y:0,w:n[0].w,h:n[0].h,i:n[0].i});let m=0,d=0,r=n[0].w,x=n[0].h;function y(){const u=[];return h.forEach((o,v)=>{u.push({x:o.x+o.w+t,y:o.y,align:"left",anchorIdx:v}),u.push({x:o.x-t,y:o.y,align:"right",anchorIdx:v}),u.push({x:o.x,y:o.y-t,align:"bottom",anchorIdx:v}),u.push({x:o.x,y:o.y+o.h+t,align:"top",anchorIdx:v}),u.push({x:o.x-t,y:o.y-t,align:"corner-topleft",anchorIdx:v}),u.push({x:o.x+o.w+t,y:o.y-t,align:"corner-topright",anchorIdx:v}),u.push({x:o.x-t,y:o.y+o.h+t,align:"corner-bottomleft",anchorIdx:v}),u.push({x:o.x+o.w+t,y:o.y+o.h+t,align:"corner-bottomright",anchorIdx:v})}),u}const W=h[0].x+h[0].w/2,f=h[0].y+h[0].h/2;function X(u,o,v){const w=u.x+o/2,Y=u.y+v/2;return Math.sqrt((w-W)*(w-W)+(Y-f)*(Y-f))}for(let u=1;u<n.length;++u){const{w:o,h:v,i:w}=n[u];let Y=1/0,s=null;const b=y();for(const A of b){const S=[{x:A.x,y:A.y},{x:A.x-o,y:A.y},{x:A.x,y:A.y-v},{x:A.x-o,y:A.y-v}];for(const l of S){let c=!1;for(const i of h)if(l.x<i.x+i.w+t&&l.x+o+t>i.x&&l.y<i.y+i.h+t&&l.y+v+t>i.y){c=!0;break}if(c)continue;let a=!1;for(const i of h)if(Math.abs(l.x+o+t-i.x)<1e-6&&l.y<i.y+i.h+t&&l.y+v>i.y||Math.abs(l.x-(i.x+i.w+t))<1e-6&&l.y<i.y+i.h+t&&l.y+v>i.y||Math.abs(l.y+v+t-i.y)<1e-6&&l.x<i.x+i.w+t&&l.x+o>i.x||Math.abs(l.y-(i.y+i.h+t))<1e-6&&l.x<i.x+i.w+t&&l.x+o>i.x){a=!0;break}if(!a)continue;const I=X(l,o,v);I<Y&&(Y=I,s=l)}}s||(s={x:m,y:x+t}),h.push({x:s.x,y:s.y,w:o,h:v,i:w}),m=Math.min(m,s.x),d=Math.min(d,s.y),r=Math.max(r,s.x+o),x=Math.max(x,s.y+v)}const H=-m,p=-d,M=r-m+2*t,g=x-d+2*t,k=h.map(u=>({x:u.x+H+t,y:u.y+p+t,w:e[u.i].w,h:e[u.i].h,imageIndex:u.i}));return{canvasWidth:M,canvasHeight:g,items:k}}function wt(e,t=0){const n=e.reduce((M,g)=>M+g.w*g.h,0),h=e.reduce((M,g)=>M+g.w/g.h,0)/e.length;let m=Math.sqrt(n/h),d=h*m;d=Math.round(d),m=Math.round(m);const r=e.map((M,g)=>({...M,i:g,area:M.w*M.h,x:0,y:0,rw:0,rh:0}));r.sort((M,g)=>g.area-M.area);function x(M,g){if(M.length===0||g===0)return 1/0;const u=M.reduce((v,w)=>v+w.area,0)/g;let o=0;for(const v of M){const w=v.area/u,Y=Math.max(w/u,u/w);o=Math.max(o,Y)}return o}function y(M,g,k,u,o){if(M.length===0)return;if(M.length===1){M[0].x=g,M[0].y=k,M[0].rw=u,M[0].rh=o;return}const v=u>o;let w=[],Y=0;if(v){const s=u;for(let c=1;c<=M.length;c++){const a=M.slice(0,c),I=x(a,s);if(c===1)w=a,Y=c;else{const i=x(M.slice(0,c-1),s);if(I<i)w=a,Y=c;else break}}const A=w.reduce((c,a)=>c+a.area,0)/s;let S=g;for(const c of w){const a=c.area/A;c.x=S,c.y=k,c.rw=a-t,c.rh=A-t,S+=a}const l=M.slice(Y);l.length>0&&y(l,g,k+A,u,o-A)}else{const s=o;for(let c=1;c<=M.length;c++){const a=M.slice(0,c),i=a.reduce((P,E)=>P+E.area,0)/s;let C=0;for(const P of a){const E=P.area/i,R=Math.max(i/E,E/i);C=Math.max(C,R)}if(c===1)w=a,Y=c;else{const P=M.slice(0,c-1),R=P.reduce((O,$)=>O+$.area,0)/s;let F=0;for(const O of P){const $=O.area/R,_=Math.max(R/$,$/R);F=Math.max(F,_)}if(C<F)w=a,Y=c;else break}}const A=w.reduce((c,a)=>c+a.area,0)/s;let S=k;for(const c of w){const a=c.area/A;c.x=g,c.y=S,c.rw=A-t,c.rh=a-t,S+=a}const l=M.slice(Y);l.length>0&&y(l,g+A,k,u-A,o)}}const W=d-2*t,f=m-2*t;y(r,t,t,W,f);let X=0,H=0;for(const M of r)X=Math.max(X,M.x+M.rw),H=Math.max(H,M.y+M.rh);d=Math.round(X+t),m=Math.round(H+t);const p=r.map(M=>{const g=M.x,k=M.y,u=M.rw,o=M.rh;return{x:g,y:k,w:u,h:o,imageIndex:M.i}});return{canvasWidth:d,canvasHeight:m,items:p}}let Z=null,j=null,q=null;self.onmessage=async e=>{if(e.data.type==="compose"){self.postMessage({type:"start"});try{const{offscreenCanvas:t,images:n,loadedImgs:h,options:m}=e.data;if(h&&(q&&q.forEach(f=>f.close()),q=h),!q||q.length!==n.length){self.postMessage({type:"error",error:"No bitmaps available in worker"});return}const d={images:n,loadedImages:q,normalizeSize:m.normalizeSize,layout:m.layout,spacing:m.spacing,fit:m.fit,scale:m.scale,justify:m.justify,resizeEnabled:m.resizeEnabled,resizeAmount:m.resizeAmount,resizeSequence:m.resizeSequence},r=JSON.stringify({...d,images:d.images.map(f=>[f.id,f.width,f.height]),dims:d.loadedImages.map(f=>[f.width,f.height])});let x;Z===r&&j?x=j:(x=rt(d),Z=r,j=x),t.width=x.canvasWidth,t.height=x.canvasHeight;const y=t.getContext("2d");if(!y){self.postMessage({type:"error",error:"Failed to get 2d context from offscreen canvas"});return}z(y,x,n,q,m);const W=t.transferToImageBitmap();self.postMessage({type:"complete",canvasWidth:t.width,canvasHeight:t.height,imageBitmap:W},{transfer:[W]})}catch(t){self.postMessage({type:"error",error:t instanceof Error?t.message:"Unknown error in draw worker"})}}}})();
